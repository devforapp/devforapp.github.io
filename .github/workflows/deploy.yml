# TianDev Studio å®˜ç½‘è‡ªåŠ¨éƒ¨ç½²å·¥ä½œæµ
# å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages

name: ğŸš€ Deploy TianDev Studio Website

on:
  # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  push:
    branches: [ main, master ]
  # å½“åˆ›å»º Pull Request æ—¶è§¦å‘ï¼ˆä»…æ„å»ºï¼Œä¸éƒ¨ç½²ï¼‰
  pull_request:
    branches: [ main, master ]
  # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
  workflow_dispatch:

# è®¾ç½®å¿…è¦çš„æƒé™
permissions:
  contents: read
  pages: write
  id-token: write

# ç¡®ä¿åŒæ—¶åªæœ‰ä¸€ä¸ªéƒ¨ç½²åœ¨è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºä½œä¸š
  build:
    name: ğŸ”¨ Build Website
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´çš„ git å†å²
        
      - name: ğŸ”§ é…ç½® GitHub Pages
        uses: actions/configure-pages@v4
        
      - name: ğŸ“¦ å®‰è£… Node.jsï¼ˆç”¨äºå¯é€‰çš„æ„å»ºå·¥å…·ï¼‰
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
        continue-on-error: true
        
      - name: ğŸ› ï¸ æ„å»ºç½‘ç«™
        run: |
          echo "ğŸŒŸ å¼€å§‹æ„å»º TianDev Studio å®˜ç½‘..."
          
          # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
          echo "ğŸ“‹ æ£€æŸ¥å…³é”®æ–‡ä»¶..."
          ls -la index.html _config.yml favicon.svg
          
          # éªŒè¯ HTML è¯­æ³•ï¼ˆå¯é€‰ï¼‰
          if command -v htmlhint &> /dev/null; then
            echo "ğŸ” éªŒè¯ HTML è¯­æ³•..."
            htmlhint index.html
          fi
          
          # æ£€æŸ¥ SVG å›¾æ ‡
          echo "ğŸ¨ æ£€æŸ¥ SVG å›¾æ ‡..."
          find assets/icons -name "*.svg" -type f | wc -l
          
          # éªŒè¯ JavaScript è¯­æ³•ï¼ˆå¯é€‰ï¼‰
          if command -v jshint &> /dev/null; then
            echo "ğŸ” éªŒè¯ JavaScript è¯­æ³•..."
            jshint assets/js/*.js || true
          fi
          
          echo "âœ… é™æ€ç½‘ç«™æ„å»ºå®Œæˆï¼Œå‡†å¤‡éƒ¨ç½²ï¼"
          
      - name: ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-pages-artifact@v3
        with:
          path: .
          
      - name: ğŸ“Š ç”Ÿæˆæ„å»ºæŠ¥å‘Š
        run: |
          echo "ğŸ“ˆ æ„å»ºç»Ÿè®¡ä¿¡æ¯ï¼š"
          echo "- HTML æ–‡ä»¶: $(find . -name "*.html" -type f | wc -l)"
          echo "- CSS æ–‡ä»¶: $(find . -name "*.css" -type f | wc -l)"
          echo "- JS æ–‡ä»¶: $(find . -name "*.js" -type f | wc -l)"
          echo "- SVG å›¾æ ‡: $(find . -name "*.svg" -type f | wc -l)"
          echo "- æ€»æ–‡ä»¶å¤§å°: $(du -sh . | cut -f1)"

  # éƒ¨ç½²ä½œä¸š
  deploy:
    name: ğŸš€ Deploy to GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    # åªåœ¨æ¨é€åˆ° main åˆ†æ”¯æ—¶éƒ¨ç½²ï¼ˆä¸åœ¨ PR æ—¶éƒ¨ç½²ï¼‰
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
    
    steps:
      - name: ğŸŒ éƒ¨ç½²åˆ° GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: ğŸ‰ éƒ¨ç½²æˆåŠŸé€šçŸ¥
        run: |
          echo "ğŸŠ TianDev Studio å®˜ç½‘éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸ”— ç½‘ç«™åœ°å€: ${{ steps.deployment.outputs.page_url }}"
          echo "ğŸ“… éƒ¨ç½²æ—¶é—´: $(date)"
          echo "ğŸ”„ æäº¤å“ˆå¸Œ: ${{ github.sha }}"